<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Service Exchange - Buy and Sell Any Service</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1;
            --dark: #1e293b;
            --light: #f8fafc;
            --silver: #94a3b8;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .hero {
            padding: 120px 0;
            color: white;
            text-align: center;
        }
        
        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 1.5rem;
        }
        
        .hero p {
            font-size: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .feature-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        
        .btn-primary-custom {
            background: linear-gradient(135deg, var(--primary), #4f46e5);
            border: none;
            padding: 12px 30px;
            font-weight: 600;
            border-radius: 8px;
        }
        
        .service-tag {
            display: inline-block;
            padding: 6px 14px;
            background: var(--light);
            border-radius: 20px;
            margin: 4px;
            font-size: 14px;
        }
        
        .stats {
            background: var(--dark);
            color: white;
            padding: 60px 0;
        }
        
        .modal-content {
            border-radius: 12px;
        }
        
        .exchange-rate-box {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 250px;
        }
        
        .exchange-rate-box h6 {
            margin: 0 0 8px 0;
            color: var(--dark);
            font-weight: 600;
            font-size: 14px;
        }
        
        .exchange-rate-box .rate {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .exchange-rate-box .coin {
            color: #f59e0b;
            font-weight: 700;
        }
        
        .exchange-rate-box .seat-badge {
            background: var(--silver);
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .exchange-rate-box small {
            display: block;
            margin-top: 8px;
            color: #64748b;
        }

        /* Account Dropdown Styles */
        .account-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .account-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .account-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        .account-window {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 8px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            width: 400px;
            z-index: 1100;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .account-dropdown:hover .account-window {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .account-header {
            padding: 20px 20px 15px;
            border-bottom: 1px solid var(--light);
        }
        
        .account-section {
            padding: 15px 20px;
        }
        
        .account-section:not(:last-child) {
            border-bottom: 1px solid var(--light);
        }
        
        .reputation-display {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 8px;
        }
        
        .star-rating {
            color: #fbbf24;
            font-size: 18px;
        }
        
        .bid-item {
            padding: 12px;
            background: #f8fafc;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .bid-item h6 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        
        .bid-item p {
            margin: 0;
            font-size: 13px;
            color: #64748b;
        }
        
        .bid-actions {
            margin-top: 8px;
        }
        
        .btn-xs {
            padding: 3px 8px;
            font-size: 12px;
        }
        
        .job-item {
            padding: 12px;
            background: #f8fafc;
            border-radius: 6px;
            margin-bottom: 8px;
        }
        
        .job-item h6 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        
        .job-item p {
            margin: 0;
            font-size: 13px;
            color: #64748b;
        }
        
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .logout-btn {
            background: #dc2626;
            border: none;
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .logout-btn:hover {
            background: #b91c1c;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand fw-bold" href="https://theservicesexchange.com">The Service Exchange</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="https://theservicesexchange.com/about.html">About</a>
                <a class="nav-link" href="https://theservicesexchange.com/seats.html">Seats</a>
                <a class="nav-link" href="https://theservicesexchange.com/api_docs.html">API Docs</a>
                
                <!-- Account dropdown (shown when logged in) -->
                <div id="accountDropdown" class="account-dropdown" style="display: none;">
                    <button class="account-btn">
                        <span id="accountUsername">Account</span> ‚ñº
                    </button>
                    <div class="account-window">
                        <div class="account-header">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0" id="accountDisplayName">Loading...</h5>
                                <button class="logout-btn" onclick="logout()">Logout</button>
                            </div>
                            <div class="reputation-display">
                                <span class="star-rating" id="starDisplay">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</span>
                                <span id="ratingText">4.5 (12 ratings)</span>
                            </div>
                        </div>
                        
                        <div class="account-section">
                            <h6>Outstanding Bids</h6>
                            <div class="loading-spinner" id="bidsLoading">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                <span class="ms-2">Loading bids...</span>
                            </div>
                            <div id="outstandingBids">
                                <p class="text-muted mb-0">No outstanding bids</p>
                            </div>
                        </div>
                        
                        <div class="account-section">
                            <h6>Active Jobs</h6>
                            <div class="loading-spinner" id="activeJobsLoading">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                <span class="ms-2">Loading active jobs...</span>
                            </div>
                            <div id="activeJobs">
                                <p class="text-muted mb-0">No active jobs</p>
                            </div>
                        </div>
                        
                        <div class="account-section">
                            <h6>Recent Completed Jobs</h6>
                            <div class="loading-spinner" id="jobsLoading">
                                <div class="spinner-border spinner-border-sm" role="status"></div>
                                <span class="ms-2">Loading jobs...</span>
                            </div>
                            <div id="completedJobs">
                                <p class="text-muted mb-0">No completed jobs</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Login button (shown when not logged in) -->
                <button id="loginButton" class="btn btn-light ms-3" onclick="showAuth()">Get Started</button>
            </div>
        </div>
    </nav>
    
    <!-- Exchange Rate Box -->
    <div class="exchange-rate-box">
        <h6>$THERSX Exchange Rate</h6>
        <div class="rate">
            <span class="coin">1,000 $THERSX</span>
            <span>=</span>
            <span class="seat-badge">1 SILVER SEAT</span>
        </div>
        <small>Silver seats valid for 1 year</small>
    </div>

    <!-- Hero -->
    <section class="hero">
        <div class="container">
            <h1>The Service Exchange</h1>
            <p>Buy and sell any service through intelligent matching</p>
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <button class="btn btn-light btn-lg me-3" onclick="showBuyerForm()">I Need a Service</button>
                    <button class="btn btn-primary-custom btn-lg" onclick="showProviderForm()">I Provide Services</button>
                </div>
            </div>
            
            <div class="mt-5">
                <span class="service-tag">House Cleaning</span>
                <span class="service-tag">Web Development</span>
                <span class="service-tag">Tutoring</span>
                <span class="service-tag">Graphic Design</span>
                <span class="service-tag">Home Repairs</span>
                <span class="service-tag">Photography</span>
            </div>
        </div>
    </section>

    <!-- Features -->
    <section class="py-5" style="background: rgba(255,255,255,0.1);">
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="feature-card">
                        <h3>üéØ Smart Matching</h3>
                        <p>AI-powered matching connects you with the perfect service provider or job.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <h3>‚≠ê Reputation Based</h3>
                        <p>Build your reputation and get matched with better opportunities.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card">
                        <h3>üí∞ Fair Pricing</h3>
                        <p>Market-driven pricing ensures fair rates for everyone.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Auth Modal -->
    <div class="modal fade" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Get Started</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs mb-3">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#login">Login</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#register">Register</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane active" id="login">
                            <form id="loginForm">
                                <div class="mb-3">
                                    <input type="text" class="form-control" placeholder="Username" id="loginUsername" required>
                                </div>
                                <div class="mb-3">
                                    <input type="password" class="form-control" placeholder="Password" id="loginPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Login</button>
                            </form>
                        </div>
                        
                        <div class="tab-pane" id="register">
                            <form id="registerForm">
                                <div class="mb-3">
                                    <input type="text" class="form-control" placeholder="Username" id="regUsername" required>
                                </div>
                                <div class="mb-3">
                                    <input type="password" class="form-control" placeholder="Password (min 8 chars)" id="regPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Register</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Service Request Modal -->
    <div class="modal fade" id="bidModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Request a Service</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bidForm">
                        <div class="mb-3">
                            <textarea class="form-control" rows="3" placeholder="Describe the service you need" id="bidService" required></textarea>
                        </div>
                        <div class="mb-3">
                            <input type="number" class="form-control" placeholder="Price (USD)" id="bidPrice" required>
                        </div>
                        <div class="mb-3">
                            <select class="form-control" id="bidLocationType">
                                <option value="physical">Physical (In-Person)</option>
                                <option value="remote">Remote (Online)</option>
                                <option value="hybrid">Hybrid</option>
                            </select>
                        </div>
                        <div class="mb-3" id="addressField">
                            <input type="text" class="form-control" placeholder="Service Address" id="bidAddress">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Submit Request</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Provider Modal -->
    <div class="modal fade" id="providerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Find a Job</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <strong>Note:</strong> Finding jobs requires a valid seat. If you don't have a seat, visit the <a href="/seats.html">Seats page</a> to learn how to obtain one.
                    </div>
                    <form id="providerForm">
                        <div class="mb-3">
                            <h6>Seat Credentials</h6>
                            <input type="text" class="form-control mb-2" placeholder="Seat ID" id="seatId" required>
                            <input type="text" class="form-control mb-2" placeholder="Seat Owner" id="seatOwner" required>
                            <input type="password" class="form-control" placeholder="Seat Secret (MD5 hash)" id="seatSecret" required>
                        </div>
                        <hr>
                        <div class="mb-3">
                            <textarea class="form-control" rows="3" placeholder="Your capabilities and services" id="capabilities" required></textarea>
                        </div>
                        <div class="mb-3">
                            <select class="form-control" id="providerLocationType">
                                <option value="physical">Physical (In-Person)</option>
                                <option value="remote">Remote (Online)</option>
                                <option value="hybrid">Both</option>
                            </select>
                        </div>
                        <div class="mb-3" id="providerAddressField">
                            <input type="text" class="form-control" placeholder="Your Location" id="providerAddress">
                        </div>
                        <div class="mb-3" id="distanceField">
                            <input type="number" class="form-control" placeholder="Max Distance (miles)" id="maxDistance" value="10">
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Find Job</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const API_URL = 'https://rse-api.com:5003';
        let authToken = null;
        let currentUser = null;
        let outstandingBids = [];
        let completedJobs = [];
        let activeJobs = [];
        
        // Initialize the page
        window.addEventListener('load', () => {
            authToken = localStorage.getItem('auth_token');
            if (authToken) {
                loadAccountData();
                updateUIForLoggedInUser();
            }
        });
        
        function updateUIForLoggedInUser() {
            document.getElementById('loginButton').style.display = 'none';
            document.getElementById('accountDropdown').style.display = 'inline-block';
        }
        
        function updateUIForLoggedOutUser() {
            document.getElementById('loginButton').style.display = 'inline-block';
            document.getElementById('accountDropdown').style.display = 'none';
        }
        
        async function loadAccountData() {
            try {
                // Load account info
                const accountResponse = await fetch(`${API_URL}/account`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                
                if (accountResponse.ok) {
                    currentUser = await accountResponse.json();
                    updateAccountDisplay();
                }
                
                // Load outstanding bids (assuming there might be an endpoint for this)
                // For now, we'll show placeholder data since the API docs don't specify this endpoint
                loadOutstandingBids();
                loadCompletedJobs();
                
            } catch (error) {
                console.error('Error loading account data:', error);
            }
        }
        
        function updateAccountDisplay() {
            if (!currentUser) return;
            
            document.getElementById('accountUsername').textContent = currentUser.username;
            document.getElementById('accountDisplayName').textContent = currentUser.username;
            
            // Update star display
            const stars = Math.round(currentUser.stars || 0);
            const starDisplay = '‚òÖ'.repeat(stars) + '‚òÜ'.repeat(5 - stars);
            document.getElementById('starDisplay').textContent = starDisplay;
            document.getElementById('ratingText').textContent = 
                `${currentUser.stars || 0} (${currentUser.total_ratings || 0} ratings)`;
        }
        
        async function loadOutstandingBids() {
            const bidsContainer = document.getElementById('outstandingBids');
            const loadingSpinner = document.getElementById('bidsLoading');
            
            loadingSpinner.style.display = 'block';
            
            try {
                const response = await fetch(`${API_URL}/my_bids`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                
                loadingSpinner.style.display = 'none';
                
                if (response.ok) {
                    const data = await response.json();
                    outstandingBids = data.bids || [];
                    updateBidsDisplay();
                } else {
                    bidsContainer.innerHTML = '<p class="text-danger">Error loading bids</p>';
                }
                
            } catch (error) {
                loadingSpinner.style.display = 'none';
                bidsContainer.innerHTML = '<p class="text-danger">Network error loading bids</p>';
            }
        }
        
        function updateBidsDisplay() {
            const container = document.getElementById('outstandingBids');
            
            if (outstandingBids.length === 0) {
                container.innerHTML = '<p class="text-muted mb-0">No outstanding bids</p>';
                return;
            }
            
            container.innerHTML = outstandingBids.map(bid => `
                <div class="bid-item">
                    <h6>${bid.service}</h6>
                    <p>Price: ${bid.price} ‚Ä¢ Expires: ${new Date(bid.end_time * 1000).toLocaleString()}</p>
                    ${bid.location_type !== 'remote' ? `<p class="text-muted">Location: ${bid.address || 'Physical service'}</p>` : '<p class="text-muted">Remote service</p>'}
                    <div class="bid-actions">
                        <button class="btn btn-danger btn-xs" onclick="cancelBid('${bid.bid_id}')">Cancel</button>
                    </div>
                </div>
            `).join('');
        }
        
        async function loadCompletedJobs() {
            const jobsContainer = document.getElementById('completedJobs');
            const jobsLoadingSpinner = document.getElementById('jobsLoading');
            const activeJobsContainer = document.getElementById('activeJobs');
            const activeJobsLoadingSpinner = document.getElementById('activeJobsLoading');
            
            jobsLoadingSpinner.style.display = 'block';
            activeJobsLoadingSpinner.style.display = 'block';
            
            try {
                const response = await fetch(`${API_URL}/my_jobs`, {
                    headers: {'Authorization': `Bearer ${authToken}`}
                });
                
                jobsLoadingSpinner.style.display = 'none';
                activeJobsLoadingSpinner.style.display = 'none';
                
                if (response.ok) {
                    const data = await response.json();
                    completedJobs = data.completed_jobs || [];
                    activeJobs = data.active_jobs || [];
                    updateJobsDisplay();
                    updateActiveJobsDisplay();
                } else {
                    jobsContainer.innerHTML = '<p class="text-danger">Error loading jobs</p>';
                    activeJobsContainer.innerHTML = '<p class="text-danger">Error loading active jobs</p>';
                }
                
            } catch (error) {
                jobsLoadingSpinner.style.display = 'none';
                activeJobsLoadingSpinner.style.display = 'none';
                jobsContainer.innerHTML = '<p class="text-danger">Network error loading jobs</p>';
                activeJobsContainer.innerHTML = '<p class="text-danger">Network error loading active jobs</p>';
            }
        }
        
        function updateActiveJobsDisplay() {
            const container = document.getElementById('activeJobs');
            
            if (activeJobs.length === 0) {
                container.innerHTML = '<p class="text-muted mb-0">No active jobs</p>';
                return;
            }
            
            container.innerHTML = activeJobs.map(job => `
                <div class="job-item">
                    <h6>${job.service}</h6>
                    <p>Price: ${job.price} ‚Ä¢ Accepted: ${new Date(job.accepted_at * 1000).toLocaleDateString()} ‚Ä¢ Role: ${job.role}</p>
                    <p class="text-muted">Partner: ${job.counterparty}</p>
                    ${job.location_type !== 'remote' ? `<small class="text-muted">Location: ${job.address || 'Physical service'}</small>` : '<small class="text-muted">Remote service</small>'}
                </div>
            `).join('');
        }
        
        function updateJobsDisplay() {
            const container = document.getElementById('completedJobs');
            
            if (completedJobs.length === 0) {
                container.innerHTML = '<p class="text-muted mb-0">No completed jobs</p>';
                return;
            }
            
            container.innerHTML = completedJobs.map(job => `
                <div class="job-item">
                    <h6>${job.service}</h6>
                    <p>Price: ${job.price} ‚Ä¢ Completed: ${new Date(job.completed_at * 1000).toLocaleDateString()} ‚Ä¢ Role: ${job.role}</p>
                    <div class="d-flex justify-content-between">
                        <small>You rated: ${job.my_rating ? '‚òÖ'.repeat(job.my_rating) + '‚òÜ'.repeat(5 - job.my_rating) : 'Not rated'}</small>
                        <small>They rated: ${job.their_rating ? '‚òÖ'.repeat(job.their_rating) + '‚òÜ'.repeat(5 - job.their_rating) : 'Not rated'}</small>
                    </div>
                </div>
            `).join('');
        }
        
        async function cancelBid(bidId) {
            if (!confirm('Are you sure you want to cancel this bid?')) return;
            
            try {
                const response = await fetch(`${API_URL}/cancel_bid`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ bid_id: bidId })
                });
                
                if (response.ok) {
                    alert('Bid cancelled successfully');
                    // Remove from local array and update display
                    outstandingBids = outstandingBids.filter(bid => bid.bid_id !== bidId);
                    updateBidsDisplay();
                } else {
                    const error = await response.json();
                    alert(`Failed to cancel bid: ${error.error || 'Unknown error'}`);
                }
            } catch (error) {
                alert('Network error while cancelling bid');
            }
        }
        
        function logout() {
            authToken = null;
            currentUser = null;
            localStorage.removeItem('auth_token');
            updateUIForLoggedOutUser();
            alert('Logged out successfully');
        }
        
        function showAuth() {
            new bootstrap.Modal(document.getElementById('authModal')).show();
        }
        
        function showBuyerForm() {
            if (!authToken) {
                showAuth();
                return;
            }
            new bootstrap.Modal(document.getElementById('bidModal')).show();
        }
        
        function showProviderForm() {
            if (!authToken) {
                showAuth();
                return;
            }
            new bootstrap.Modal(document.getElementById('providerModal')).show();
        }
        
        // Location type handling
        document.getElementById('bidLocationType').addEventListener('change', (e) => {
            document.getElementById('addressField').style.display = 
                e.target.value === 'remote' ? 'none' : 'block';
        });
        
        document.getElementById('providerLocationType').addEventListener('change', (e) => {
            const showAddress = e.target.value !== 'remote';
            document.getElementById('providerAddressField').style.display = showAddress ? 'block' : 'none';
            document.getElementById('distanceField').style.display = showAddress ? 'block' : 'none';
        });
        
        // Login
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const response = await fetch(`${API_URL}/login`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    username: document.getElementById('loginUsername').value,
                    password: document.getElementById('loginPassword').value
                })
            });
            
            if (response.ok) {
                const data = await response.json();
                authToken = data.access_token;
                localStorage.setItem('auth_token', authToken);
                bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                updateUIForLoggedInUser();
                loadAccountData();
                alert('Login successful!');
            } else {
                alert('Login failed');
            }
        });
        
        // Register
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const response = await fetch(`${API_URL}/register`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    username: document.getElementById('regUsername').value,
                    password: document.getElementById('regPassword').value
                })
            });
            
            if (response.ok) {
                alert('Registration successful! Please login.');
                document.querySelector('[href="#login"]').click();
            } else {
                alert('Registration failed');
            }
        });
        
        // Submit bid
        document.getElementById('bidForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                service: document.getElementById('bidService').value,
                price: parseFloat(document.getElementById('bidPrice').value),
                end_time: Math.floor(Date.now() / 1000) + 86400, // 24 hours
                location_type: document.getElementById('bidLocationType').value
            };
            
            if (data.location_type !== 'remote') {
                data.address = document.getElementById('bidAddress').value;
            }
            
            const response = await fetch(`${API_URL}/submit_bid`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                const result = await response.json();
                alert(`Service request submitted! ID: ${result.bid_id}`);
                bootstrap.Modal.getInstance(document.getElementById('bidModal')).hide();
                // Clear the form
                document.getElementById('bidForm').reset();
                // Refresh outstanding bids if user is logged in
                if (authToken) {
                    loadOutstandingBids();
                }
            } else {
                alert('Failed to submit request');
            }
        });
        
        // Find job (with seat verification)
        document.getElementById('providerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                seat: {
                    id: document.getElementById('seatId').value,
                    owner: document.getElementById('seatOwner').value,
                    secret: document.getElementById('seatSecret').value
                },
                capabilities: document.getElementById('capabilities').value,
                location_type: document.getElementById('providerLocationType').value
            };
            
            if (data.location_type !== 'remote') {
                data.address = document.getElementById('providerAddress').value;
                data.max_distance = parseFloat(document.getElementById('maxDistance').value);
            }
            
            const response = await fetch(`${API_URL}/grab_job`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify(data)
            });
            
            if (response.ok) {
                const job = await response.json();
                alert(`Job found!\nService: ${job.service}\nPrice: $${job.price}\nBuyer: ${job.buyer_username}`);
                bootstrap.Modal.getInstance(document.getElementById('providerModal')).hide();
            } else if (response.status === 204) {
                alert('No matching jobs available');
            } else if (response.status === 403) {
                const error = await response.json();
                alert(`Seat verification failed: ${error.error}`);
            } else {
                alert('Failed to find job');
            }
        });
    </script>
</body>
</html>